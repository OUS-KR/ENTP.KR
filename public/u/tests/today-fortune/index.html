<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - ENTP</title>
    <link rel="stylesheet" href="/u/tests/assets/css/main.css?20251010120000">
    <style>
        /* Custom styles are now handled by main.css through .info-card */
        .card-title .icon {
            display: inline-block;
            margin-right: 0.5em;
            font-style: normal;
        }
    </style>
</head>
<body>
    <header class="main-nav">
        <a href="/u/tests/" class="logo">ENTP.KR Tests</a>
        <div class="nav-right-section">
            <nav class="nav-links" id="nav-links"></nav>
            <button id="theme-switcher" class="theme-switcher">🌙</button>
            <button id="hamburger" class="hamburger">☰</button>
        </div>
    </header>

    <div class="container">
        <h1>오늘의 ENTP 운세</h1>
        <div id="fortuneContent">
            <div class="card info-card">
                <div class="card-title"><span class="icon">💡</span> 오늘의 조언</div>
                <p id="adviceDisplay">조언을 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📝</span> 오늘의 과제</div>
                <p id="taskDisplay">과제를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">📈</span> ENTP 지수</div>
                <p id="mbtiIndexDisplay">ENTP 지수를 불러오는 중...</p>
            </div>
            <div class="card info-card">
                <div class="card-title"><span class="icon">🔑</span> 행운의 키워드</div>
                <p id="keywordDisplay">키워드를 불러오는 중...</p>
            </div>
        </div>
    </div>

    <script src="/u/tests/assets/js/main.js?20251010170000" defer></script>
    <script src="/u/tests/assets/js/dynamic-menu.js?20251010170000" defer></script>
    <script>
    function getDailySeed() {
        const today = new Date();
        return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
    }

    function mulberry32(seed) {
        return function() {
            seed |= 0;
            seed = seed + 0x6D2B79F5 | 0;
            let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
            t = t + Math.imul(t ^ t >>> 7, 61 | t) | 0;
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }

    /**
     * 한국어 조사(e.g., 은/는, 을/를)를 앞 단어의 받침 유무에 따라 올바르게 선택하는 함수
     * @param {string} text - 조사가 붙을 단어
     * @param {string} particle - '/'로 구분된 조사 쌍 (예: "을/를")
     * @returns {string} - 선택된 조사
     */
    function josa(text, particle) {
        const particles = particle.split('/');
        if (particles.length < 2) return particle;

        if (typeof text !== 'string' || text.length === 0) return particles[1];
        const lastChar = text[text.length - 1];
        const charCode = lastChar.charCodeAt(0);

        // 한글 (가-힣) 범위 체크
        if (charCode < 0xAC00 || charCode > 0xD7A3) {
            // 한글이 아니면 기본값(받침 없는 경우) 반환
            return particles[1];
        }

        const hasBatchim = (charCode - 0xAC00) % 28 > 0;
        return hasBatchim ? particles[0] : particles[1];
    }

    // --- Enhanced Generative Data Parts ---
    const data = {
        advice: {
            openings: ["오늘은", "오늘 당신의", "지금은", "오늘은 특별히"],
            subjects: ["혁신적인 아이디어가", "날카로운 통찰력이", "기발한 문제 해결 능력이", "빠른 두뇌 회전이", "새로운 가능성이", "도전적인 정신이"],
            verbs: ["빛을 발하는 날입니다.", "새로운 길을 열 것입니다.", "주변을 놀라게 할 것입니다.", "예상치 못한 기회를 가져다줍니다.", "당신을 한 단계 도약시킬 것입니다."],
            connectors: ["따라서", "그러니", "이 기회를 빌어", "망설이지 말고"],
            actions: ["기존의 틀을 깨고 새로운 시도를 해보세요.", "흥미로운 논쟁에 적극적으로 참여해 보세요.", "복잡한 문제를 다양한 각도에서 분석해 보세요.", "당신의 아이디어를 과감하게 현실에 적용해 보세요.", "평소와 다른 분야의 지식을 탐구해 보세요.", "주변 사람들과 자유롭게 의견을 교환해 보세요."]
        },
        task: {
            types: ["탐구하기:", "도전하기:", "분석하기:", "상상하기:"],
            actions: ["오랫동안 궁금했던", "최근 떠오른", "아무도 시도하지 않은", "당연하게 여겨지는"],
            subjects: ["복잡한 사회 문제", "새로운 기술 트렌드", "기존 시스템의 허점", "미래 사회의 변화", "창의적인 사업 아이디어", "예술적 영감의 원천"],
            verbs: ["에 대해 깊이 탐구해 보세요.", "의 논리적 모순을 찾아보세요.", "을(를) 완전히 새로운 방식으로 재해석해 보세요.", "과/와 관련된 획기적인 해결책을 구상해 보세요.", "의 잠재력을 극대화할 방법을 브레인스토밍해 보세요."]
        },
        mbtiIndex: {
            reasons: ["혁신적인 아이디어가 샘솟아", "날카로운 논리로 무장하여", "어떤 문제든 해결할 수 있는 자신감으로", "다양한 관점을 자유롭게 넘나들며", "빠른 판단력과 뛰어난 임기응변으로"],
            results: ["새로운 가능성을 발견할 수 있습니다.", "주변을 설득하고 변화를 이끌어낼 수 있습니다.", "지적인 자극과 성취감을 만끽할 수 있습니다.", "복잡한 상황을 명쾌하게 정리할 수 있습니다."]
        },
        keywords: ["창의", "도전", "비전", "독특", "솔직", "열정", "호기심", "발명", "개혁", "가능성", "개인주의", "자유주의", "이성적", "이상주의", "창의력", "개성", "언변", "브레인스토밍", "즉흥적", "낙천적"]
    };

    // --- Generator Functions ---
    function generateAdvice(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const structureType = randFn();
        if (structureType < 0.4) {
            // Structure 1: Subject + Verb
            return `${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else if (structureType < 0.8) {
            // Structure 2: Opening + Subject + Verb
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)}`;
        } else {
            // Structure 3: Full Sentence
            return `${pick(parts.openings)} ${pick(parts.subjects)} ${pick(parts.verbs)} ${pick(parts.connectors)} ${pick(parts.actions)}`;
        }
    }

    function generateTask(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        
        const type = pick(parts.types);
        const action = pick(parts.actions);
        const subject = pick(parts.subjects);
        const verb = pick(parts.verbs);

        // 문장 조합: action + subject + verb
        let rawSentence = `${action} ${subject}${verb}`;

        // 조사 처리
        rawSentence = rawSentence
            .replace("을(를)", josa(subject, "을/를"))
            .replace("은(는)", josa(subject, "은/는"))
            .replace("이(가)", josa(subject, "이/가"))
            .replace("과/와", josa(subject, "과/와"));

        return `${type} ${rawSentence}`;
    }

    function generateMbtiIndex(randFn, parts) {
        const pick = (arr) => arr[Math.floor(randFn() * arr.length)];
        const percentage = 65 + Math.floor(randFn() * 31); // 65% to 95%
        return `${percentage}% - ${pick(parts.reasons)} ${pick(parts.results)}`;
    }

    function generateKeywords(randFn, keywords, count) {
        const shuffled = [...keywords].sort(() => randFn() - 0.5);
        return shuffled.slice(0, count).map(k => `#${k}`).join(" ");
    }

    // --- Main Execution ---
    window.onload = function() {
        try {
            const seed = getDailySeed();
            const randFn = mulberry32(seed);

            document.getElementById('adviceDisplay').innerText = generateAdvice(randFn, data.advice);
            document.getElementById('taskDisplay').innerText = generateTask(randFn, data.task);
            document.getElementById('mbtiIndexDisplay').innerText = generateMbtiIndex(randFn, data.mbtiIndex);
            document.getElementById('keywordDisplay').innerText = generateKeywords(randFn, data.keywords, 5);
        } catch (e) {
            console.error("오늘의 운세 생성 중 오류 발생:", e);
            document.getElementById('adviceDisplay').innerText = "콘텐츠를 불러오는 데 실패했습니다. 페이지를 새로고침해 주세요.";
        }
    };
</script>
</body>
</html>